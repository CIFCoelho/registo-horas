<!DOCTYPE html>
<html lang="pt">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Certoma - Dashboard de Produtividade</title>
    <link rel="icon" href="../assets/images/FC_favicon.png" type="image/x-icon">
    <link rel="stylesheet" href="css/dashboard.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>

<body>

    <!-- Authentication Overlay -->
    <div class="auth-overlay" id="auth-overlay">
        <div class="auth-modal">
            <h2>üîê Acesso Restrito</h2>
            <p>Dashboard de Ger√™ncia - Certoma</p>
            <div class="auth-error" id="auth-error">Credenciais inv√°lidas.</div>
            <form id="auth-form">
                <label for="username">Utilizador</label>
                <input type="text" id="username" name="username" required autocomplete="username" autofocus>

                <label for="password">Password</label>
                <input type="password" id="password" name="password" required autocomplete="current-password">

                <div class="auth-actions">
                    <button type="submit" class="auth-button">Entrar no Dashboard</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Custom Modal -->
    <div class="modal-overlay" id="modal-overlay">
        <div class="modal-container" id="modal-container">
            <div class="modal-header">
                <h3 id="modal-title">Modal</h3>
                <button class="modal-close" id="modal-close">&times;</button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- Dynamic content -->
            </div>
            <div class="modal-footer" id="modal-footer">
                <button class="btn btn-secondary" id="modal-cancel">Cancelar</button>
                <button class="btn btn-primary" id="modal-confirm">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toast-container"></div>

    <!-- Main Content (Hidden until Authed) -->
    <div class="dashboard-wrapper" id="dashboard-content" style="display: none;">

        <!-- Navigation Bar -->
        <nav class="navbar">
            <div class="navbar-brand">
                <span class="brand-icon">üìä</span>
                <span class="brand-text">Certoma Dashboard</span>
            </div>
            <ul class="navbar-menu" id="navbar-menu">
                <li class="nav-item active" data-view="overview">
                    <span class="nav-icon">üè†</span>
                    <span class="nav-text">Vis√£o Geral</span>
                </li>
                <li class="nav-item" data-view="employees">
                    <span class="nav-icon">üë•</span>
                    <span class="nav-text">Funcion√°rios</span>
                </li>
                <li class="nav-item" data-view="ofs">
                    <span class="nav-icon">üì¶</span>
                    <span class="nav-text">Ordens de Fabrico</span>
                </li>
                <li class="nav-item" data-view="costs">
                    <span class="nav-icon">üí∞</span>
                    <span class="nav-text">Gest√£o de Custos</span>
                </li>
            </ul>
            <div class="navbar-actions">
                <div id="connection-status" class="connection-status online">
                    <span class="status-dot"></span>
                    <span class="status-text">Online</span>
                </div>
                <button class="btn-logout" id="logout-btn">Sair</button>
            </div>
        </nav>

        <!-- Main Container -->
        <div class="container">

            <!-- Header with Date and Controls -->
            <header class="page-header">
                <div class="header-info">
                    <h1 id="page-title">Vis√£o Geral</h1>
                    <p id="current-date">A carregar...</p>
                </div>
                <div class="header-controls">
                    <label class="control-label">
                        <span>Ano:</span>
                        <select id="year-selector" class="select-control">
                        </select>
                    </label>
                    <label class="control-label" id="section-filter-container">
                        <span>Sec√ß√£o:</span>
                        <select id="section-filter" class="select-control">
                            <option value="all">Todas</option>
                            <option value="Acabamento">Acabamento</option>
                            <option value="Estofagem">Estofagem</option>
                            <option value="Pintura">Pintura</option>
                            <option value="Prepara√ß√£o">Prepara√ß√£o</option>
                            <option value="Montagem">Montagem</option>
                        </select>
                    </label>
                    <button class="btn btn-secondary" onclick="window.location.reload()">
                        <span>üîÑ</span> Atualizar
                    </button>
                </div>
            </header>

            <!-- VIEW: Overview -->
            <div id="view-overview" class="view-section active">

                <!-- Real-time Active Workers -->
                <section class="active-workers-container">
                    <div class="active-workers-header">
                        <span class="live-indicator"></span>
                        <h3>Em Labora√ß√£o Agora</h3>
                        <span class="last-updated" id="last-updated">Atualizado: --:--</span>
                    </div>
                    <div class="active-workers-list" id="active-workers-list">
                        <div class="loading-placeholder">
                            <div class="spinner"></div>
                            <span>A carregar dados em tempo real...</span>
                        </div>
                    </div>
                </section>

                <!-- Summary Stats -->
                <div class="stats-grid" id="summary-stats">
                    <div class="stat-card">
                        <h3>Total Horas (Ano)</h3>
                        <div class="value" id="stat-total-hours">
                            <span class="spinner-small"></span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <h3>Ativos Agora</h3>
                        <div class="value" id="stat-active-employees">
                            <span class="spinner-small"></span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <h3>Pr√≥xima OF Pronta</h3>
                        <div class="value" id="stat-total-ofs">
                            <span class="spinner-small"></span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <h3>Horas desde Janeiro</h3>
                        <div class="value" id="stat-most-active-section">
                            <span class="spinner-small"></span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <h3 title="Estimativa baseada nos custos/hora configurados">Custo Total Estimado</h3>
                        <div class="value" id="stat-total-cost">
                            <span class="spinner-small"></span>
                        </div>
                    </div>
                </div>

                <!-- Charts Row 1: Split Performance -->
                <div class="grid-2">
                    <div class="chart-container">
                        <h2>Acabamento ‚Äî Horas vs Unidades (Top 10)</h2>
                        <div class="chart-wrapper">
                            <div class="loading-overlay" id="loading-acabamento">
                                <div class="spinner"></div>
                            </div>
                            <canvas id="chartAcabamentoPerformance"></canvas>
                        </div>
                    </div>
                    <div class="chart-container">
                        <h2>Estofagem ‚Äî Horas vs Unidades (Top 10)</h2>
                        <div class="chart-wrapper">
                            <div class="loading-overlay" id="loading-estofagem">
                                <div class="spinner"></div>
                            </div>
                            <canvas id="chartEstofagemPerformance"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Full-width OF Progress Chart -->
                <div class="chart-container">
                    <h2>Progresso por OF (√öltimas 12)</h2>
                    <div class="chart-wrapper large">
                        <div class="loading-overlay" id="loading-of">
                            <div class="spinner"></div>
                        </div>
                        <canvas id="chartOFProgress"></canvas>
                    </div>
                </div>

                <!-- Monthly Trend Chart -->
                <div class="chart-container">
                    <h2>üìà Evolu√ß√£o Mensal</h2>
                    <div class="chart-wrapper large" id="chart-monthly-wrapper">
                        <div class="loading-overlay" id="loading-monthly">
                            <div class="spinner"></div>
                        </div>
                        <canvas id="chartMonthlyTrend"></canvas>
                    </div>
                </div>

            </div>

            <!-- VIEW: Employees -->
            <div id="view-employees" class="view-section">
                <div class="view-header">
                    <h2>üë• An√°lise de Funcion√°rios</h2>
                    <div class="search-box">
                        <input type="text" id="employee-search" placeholder="Pesquisar funcion√°rio..."
                            class="search-input">
                    </div>
                </div>

                <div class="employees-grid" id="employees-grid">
                    <div class="loading-placeholder">
                        <div class="spinner"></div>
                        <span>A carregar funcion√°rios...</span>
                    </div>
                </div>
            </div>

            <!-- VIEW: OFs -->
            <div id="view-ofs" class="view-section">
                <div class="view-header">
                    <h2>Ordens de Fabrico</h2>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <div class="search-box">
                            <input type="text" id="of-search" placeholder="Pesquisar OF..." class="search-input">
                        </div>
                        <button class="btn btn-primary" id="btn-create-of" style="display: none;">
                            <span>+</span> Criar OF
                        </button>
                    </div>
                </div>

                <div class="of-table-container">
                    <table class="data-table" id="ofs-table">
                        <thead>
                            <tr>
                                <th>OF</th>
                                <th>Horas Acabamento</th>
                                <th>Horas Estofagem</th>
                                <th>Horas Pintura</th>
                                <th>Horas Prepara√ß√£o</th>
                                <th>Horas Montagem</th>
                                <th>Total Horas</th>
                                <th title="Estimativa baseada no custo m√©dio dos funcion√°rios">Custo Est. ‚ÑπÔ∏è</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="ofs-table-body">
                            <tr>
                                <td colspan="9" class="loading-cell">
                                    <div class="spinner"></div>
                                    <span>A carregar...</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- VIEW: Costs Management -->
            <div id="view-costs" class="view-section">
                <div class="view-header">
                    <h2>üí∞ Gest√£o de Custos por Funcion√°rio</h2>
                    <button class="btn btn-primary" id="btn-add-cost">
                        <span>+</span> Adicionar Funcion√°rio
                    </button>
                </div>

                <div class="costs-table-container">
                    <table class="data-table" id="costs-table">
                        <thead>
                            <tr>
                                <th>Funcion√°rio</th>
                                <th>Custo Hora (‚Ç¨)</th>
                                <th>Total Horas (Ano)</th>
                                <th>Custo Total (‚Ç¨)</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="costs-table-body">
                            <tr>
                                <td colspan="5" class="loading-cell">
                                    <div class="spinner"></div>
                                    <span>A carregar...</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Aquecimento (Heating) Tracking -->
                <div class="chart-container" style="margin-top: 30px;">
                    <h2>Aquecimento ‚Äî Sec√ß√£o Pintura</h2>
                    <p style="color: var(--text-light); margin-bottom: 15px;">
                        Horas de utiliza√ß√£o do sistema de aquecimento (registadas na sec√ß√£o Pintura)
                    </p>
                    <div class="stats-grid" style="margin-bottom: 20px;">
                        <div class="stat-card">
                            <h3>Total Aquecimento (Ano)</h3>
                            <div class="value" id="stat-aquecimento-total">
                                <span class="spinner-small"></span>
                            </div>
                        </div>
                    </div>
                    <div class="chart-wrapper" id="chart-aquecimento-wrapper">
                        <canvas id="chartAquecimento"></canvas>
                    </div>
                </div>
            </div>

            <!-- VIEW: Detail (Employee or OF) -->
            <div id="view-detail" class="view-section">
                <button class="btn btn-back" id="back-to-main">
                    <span>‚Üê</span> Voltar
                </button>
                <div id="detail-header" class="detail-header">
                    <h2 id="detail-title">Detalhe</h2>
                    <div id="detail-subtitle" class="detail-subtitle"></div>
                </div>
                <div id="detail-content">
                    <div class="loading-placeholder">
                        <div class="spinner"></div>
                        <span>A carregar detalhes...</span>
                    </div>
                </div>
            </div>

        </div>

        <!-- Footer -->
        <footer class="dashboard-footer">
            <p>Certoma ‚Äî Sistema de Registo de Produtividade</p>
        </footer>

    </div>

    <!-- Scripts -->
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/charts.js"></script>
    <script src="js/main.js"></script>
</body>

</html>