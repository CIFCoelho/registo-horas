<!doctype html>
<meta charset=utf-8>
<title>Estofagem</title>
<style>
 body{font:20px/1 sans-serif;text-align:center} button{width:90%;margin:12px 0;height:70px}
 .on{background:#4caf50;color:#fff} .off{background:#ccc}
</style>
<h1>Registo Estofagem</h1>
<div id=wrap></div>
<script>
var EMP=['Antónia','Diana','Teresa'], URL='https://.../exec';
function render(state){ // state {nome:true/false}
  var w=document.getElementById('wrap'); w.innerHTML='';
  for(var i=0;i<EMP.length;i++){
    var n=EMP[i],b=document.createElement('button');
    b.textContent=n; b.className=state[n]?'on':'off';
    b.onclick=function(){
      var nome=this.textContent,now=new Date();
      send({func:nome,ts:now.toISOString(),acao:state[nome]?'fim':'ini'});
    };
    w.appendChild(b);
  }
}
function send(d){
  var x=new XMLHttpRequest();
  x.open('POST',URL); x.setRequestHeader('Content-Type','text/plain');
  x.onreadystatechange=function(){
    if(x.readyState==4) refresh(); // volta a pedir estado
  };
  x.send(JSON.stringify(d));
}
function refresh(){ // pede estado actual
  var x=new XMLHttpRequest();
  x.open('GET',URL+'?estado'); // devolve JSON de quem está ON
  x.onload=function(){render(JSON.parse(x.responseText));};
  x.send();
}
refresh();
</script>
